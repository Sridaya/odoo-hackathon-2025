<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - StockMaster</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; color: white; }
        .glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; text-align: center; }
        .sidebar { background: rgba(0,0,0,0.7); min-height: 100vh; }
    </style>
</head>
<body>
    <!-- Low Stock Alert -->
<div class="alert alert-warning mt-4 d-flex align-items-center" role="alert">
    <i class="fas fa-exclamation-triangle me-3 fs-4"></i>
    <div>
        <strong id="lowStockCount">0</strong> products have low stock (less than 20 units)
        <br><small>Click <a href="/products" class="alert-link">Products</a> to restock them now</small>
    </div>
</div>
<div class="container-fluid">
<div class="row">
    <div class="col-md-2 sidebar p-4">
        <h2 class="text-center mb-5">StockMaster</h2>
        <a href="/dashboard" class="text-white d-block py-3 active">Dashboard</a>
        <a href="/products" class="text-white d-block py-3">Products</a>
        <a href="/receipts" class="text-white d-block py-3">Receipts</a>
        <a href="/deliveries" class="text-white d-block py-3">Deliveries</a>
        <a href="/logout" class="text-white d-block py-3">Logout</a>
    </div>
    <div class="col-md-10 p-5">
        <h1 class="display-4">Real-Time Dashboard</h1>
        <div class="row g-4 mt-4">
            <div class="col-md-3"><div class="glass"><h5>Total Products</h5><h2 id="tp">0</h2></div></div>
            <div class="col-md-3"><div class="glass"><h5>Total Stock</h5><h2 id="ts">0</h2></div></div>
            <div class="col-md-3"><div class="glass text-warning"><h5>Low Stock</h5><h2 id="ls">0</h2></div></div>
            <div class="col-md-3"><div class="glass text-danger"><h5>Out of Stock</h5><h2 id="os">0</h2></div></div>
        </div>
    </div>
</div>
</div>
<script>
function load() {
    fetch('/api/products').then(r => r.json()).then(p => {
        let total = 0, low = 0, out = 0;
        p.forEach(x => { total += x.stock; if(x.stock == 0) out++; else if(x.stock < 20) low++; });
        document.getElementById('tp').textContent = p.length;
        document.getElementById('ts').textContent = total;
        document.getElementById('ls').textContent = low;
        document.getElementById('os').textContent = out;
    });
}
load(); setInterval(load, 2000);


</script>

<script>
function updateLowStock() {
    fetch('/api/products')
        .then(r => r.json())
        .then(products => {
            const low = products.filter(p => p.stock > 0 && p.stock < 20).length;
            document.getElementById('lowStockCount').textContent = low;
            // also update the existing "Low Stock" card if you have one
            const ls = document.getElementById('ls');
            if (ls) ls.textContent = low;
        });
}
setInterval(updateLowStock, 3000);
updateLowStock();
</script>
</body>
</html>